<!DOCTYPE html>
<html>
  <head>
    <Meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {callback: readtext,
				     packages:['corechart']});
      function readtext(){
	  var printers = [
	      [1,  'acc4150',  0],   
	      [2,  'acc5585',  1],   
	      [3,  'a2c2276',  0],   
	      [4,  'a2c3540',  0],   
	      [5,  'a3c4476',  0],   
	      [6,  'ri1c2250', 0],
	      [7,  'rbc4150',  0],
	      //[8,  'rcc4000a', 0],
	      [9,  'rcc4000b', 0],
	      [10, 'h1c3540',  0],   
	      [11, 'h2c3376',  0],   
	      [12, 'h3c7785',  1],   
	      [13, 'h4c7785',  1],   
	      [14, 'h5c7785',  1],
	      [15, 'h6c4476',  0],
	      [16, 'g1c2250',  0]
	  ];
	  for (let pri of printers) {
	      url = 'http://www.rcnp.osaka-u.ac.jp/~kobayash/rcnp_printers/status/tnr_per_'+pri[1]+'.txt';
	      fetch(url)
		  .then((response) => response.text())
		  .then((text) => draw(pri[0],pri[1],pri[2],text))
		  .catch((error) => console.log(error));
	  }
      };
      function draw(num, pname, dbl_buf, text){
	  var data_points = text;
	  data_points     = data_points.replace(/,/g," ");
	  var xy_paires   = data_points.split(/\r\n|\r|\n/);
	  var xy_arr = [['x','black','cyan','magenta','yellow']];
	  for (var i = 0; i < xy_paires.length; i++) {
              var xy_points = xy_paires[i].split(/\s+/);
              if (xy_points[0]!="" && xy_points[2]!="" && xy_points[3]!="" && xy_points[4]!="" && xy_points[5]!="") {
		  xy_arr.push([new Date(Number(xy_points[0]) * 1000), Number(xy_points[2])+2, Number(xy_points[3]), Number(xy_points[4])-2, Number(xy_points[5])-4]);
              }
	  }
	  var data = google.visualization.arrayToDataTable(xy_arr);
	  var options = {
	      'title': 'Printer #'+num+': '+pname,
	      vAxis: {
		  viewWindow: {
		      min: -5,
		      max: 105
		  },
		  ticks: [0, 25, 50, 75, 100]
	      },
	      hAxis: {
		  format: 'yyyy/MM/dd HH:mm'
	      },
	      pointSize: 3,
	      explorer: {
		  axis:'horizontal',
		  maxZoomOut:20,
		  maxZoomIn:100,
		  keepInBounds: true
	      },
	      colors: ['black', '#008b8b', 'magenta', '#9b870c']
	  };
	  var chart = new google.visualization.LineChart(document.getElementById('chart_div_'+num));
	  chart.draw(data,options);
      };
    </script>
    <title>Toner monitor for RCNP printers</title>
  </head>
  <body>

    <h1>Toner monitor for RCNP printers</h1>
    <table border="0">
      <tr>
	<td><div id="chart_div_1"  style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_2"  style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_3"  style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_4"  style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_5"  style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_6"  style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_7"  style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_8"  style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_9"  style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_10" style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_11" style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_12" style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_13" style="width: 600px; height: 300px;">No printer</div></td>
	<td><div id="chart_div_14" style="width: 600px; height: 300px;">No printer</div></td>
      </tr>
      <tr>
	<td><div id="chart_div_15" style="width: 600px; height: 300px;">No printer</div></td>
	<td></td>
      </tr>
    </table>
	
    <a href="../index.html">Back to the Home Page</a>
    <hr>
    Nobu Kobaysahi, Oct. 25, 2020.
  </body>
</html>
